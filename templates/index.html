<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Clim√°tico del Per√∫ - NASA Space Apps Challenge 2024</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css.css') }}">

    
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
</head>
<body>
    <video id="bg-video" autoplay muted loop>
        <source src="{{ url_for('static', filename='videos/video.mp4') }}" type="video/mp4">
    </video>
    
    <div class="container">
        <div class="header">
            <h1> Predicci√≥n climatica del Per√∫</h1>
            <p class="subtitle">Sistema de Predicci√≥n Clim√°tica - NASA Space Apps Challenge 2025</p>
        </div>

        <div class="system-info">
            <div class="info-grid">
                <div class="info-card">
                    <h3>Modelos Entrenados</h3>
                    <div class="value" id="modelCount">--</div>
                    <div class="description">Algoritmos de Machine Learning disponibles</div>
                </div>
                <div class="info-card">
                    <h3>Precisi√≥n Promedio</h3>
                    <div class="value" id="avgAccuracy">--%</div>
                    <div class="description">Confianza promedio en predicciones</div>
                </div>
                <div class="info-card">
                    <h3>Datos Hist√≥ricos</h3>
                    <div class="value">1990-2023</div>
                    <div class="description">34 a√±os de datos clim√°ticos del Per√∫</div>
                </div>
                <div class="info-card">
                    <h3>Regiones Cubiertas</h3>
                    <div class="value" id="regionCount">--</div>
                    <div class="description">Ciudades y departamentos incluidos</div>
                </div>
            </div>
        </div>

        <div class="main-grid">
            <div class="control-panel">
                <h2>üéØ Par√°metros de Predicci√≥n</h2>

                <button class="btn-secondary" onclick="checkModelsStatus()" style="margin-top: 10px;">
                    üîç Verificar Modelos
                </button>
                
                <div class="form-group">
                    <label for="year">üìÖ A√±o Objetivo</label>
                    <input type="number" id="year" min="2024" max="2100" value="2030">
                </div>

                <div class="form-group">
                    <label for="region">üó∫Ô∏è Regi√≥n del Per√∫</label>
                    <select id="region">
                        <option value="peru">Per√∫ (Nacional)</option>
                        <option value="lima">Lima (Costa)</option>
                        <option value="cusco">Cusco (Sierra)</option>
                        <option value="arequipa">Arequipa (Sur)</option>
                        <option value="iquitos">Iquitos (Selva)</option>
                        <option value="trujillo">Trujillo (Costa Norte)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="month">üìÜ Mes de Predicci√≥n</label>
                    <select id="month">
                        <option value="1">Enero</option>
                        <option value="2">Febrero</option>
                        <option value="3">Marzo</option>
                        <option value="4">Abril</option>
                        <option value="5">Mayo</option>
                        <option value="6" selected>Junio</option>
                        <option value="7">Julio</option>
                        <option value="8">Agosto</option>
                        <option value="9">Septiembre</option>
                        <option value="10">Octubre</option>
                        <option value="11">Noviembre</option>
                        <option value="12">Diciembre</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>ü§ñ Modelo de Machine Learning</label>
                    <div class="model-selector">
                        <div class="model-card active" data-model="random_forest">
                            <div class="icon">üå≤</div>
                            <div class="name">Random Forest</div>
                            <div class="description">Ensamble de √°rboles</div>
                        </div>
                        <div class="model-card" data-model="ridge">
                            <div class="icon">üîÑ</div>
                            <div class="name">Ridge</div>
                            <div class="description">Regularizaci√≥n L2</div>
                        </div>
                        <div class="model-card" data-model="linear">
                            <div class="icon">üìà</div>
                            <div class="name">Lineal</div>
                            <div class="description">Regresi√≥n simple</div>
                        </div>
                        <!-- CORREGIDO: Agregando los 3 modelos faltantes -->
                        <div class="model-card" data-model="lasso">
                            <div class="icon">üéØ</div>
                            <div class="name">Lasso</div>
                            <div class="description">Regularizaci√≥n L1</div>
                        </div>
                        <div class="model-card" data-model="gradient_boost">
                            <div class="icon">‚ö°</div>
                            <div class="name">Gradient Boost</div>
                            <div class="description">Boosting avanzado</div>
                        </div>
                        <div class="model-card" data-model="neural_net">
                            <div class="icon">üß†</div>
                            <div class="name">Red Neuronal</div>
                            <div class="description">Deep Learning</div>
                        </div>
                    </div>
                </div>

                <button class="predict-btn" onclick="makePrediction()">
                    üîÆ Generar Predicci√≥n
                </button>

                <button class="download-btn" onclick="downloadPredictions()">
                    üì• Descargar CSV
                </button>

                <button class="compare-btn" onclick="compareRegions()">
                    üìä Comparar Regiones
                </button>

                <div class="loading" id="loading">
                    <div class="spinner"></div>
                </div>

                <div id="messageContainer"></div>

                <div class="prediction-result" id="result">
                    <h3>üå°Ô∏è Predicci√≥n de Temperatura</h3>
                    <div class="temperature-display" id="tempValue">--¬∞C</div>
                    <div class="temperature-context" id="tempContext">Esperando predicci√≥n...</div>
                    <div id="alertIndicator"></div>
                    <div>Nivel de Confianza</div>
                    <div class="confidence-bar">
                        <div class="confidence-fill" id="confidence" style="width: 0%"></div>
                    </div>
                    <div id="confidenceText">--% Confianza</div>
                    <div id="modelUsed" style="margin-top: 15px; font-size: 0.9em; opacity: 0.8;"></div>
                </div>

                <!-- Panel de calidad del aire y UV -->
                <div class="air-quality-panel" id="airQualityPanel" style="display:none;">
                    <h3>üå´Ô∏è Calidad del Aire & UV</h3>
                    <div class="aqi-indicator" id="aqiIndicator">
                        <div class="aqi-value">--</div>
                        <div class="aqi-label">AQI</div>
                    </div>
                    <div class="uv-indicator" id="uvIndicator">
                        <div class="uv-value">--</div>
                        <div class="uv-label">√çndice UV</div>
                    </div>
                    <div class="quality-advice" id="qualityAdvice"></div>
                </div>
            </div>

            <div class="visualization-panel">
                <div class="tabs">
                    <div class="tab active" data-tab="charts">üìä Gr√°ficos</div>
                    <div class="tab" data-tab="recommendations">üè• Recomendaciones</div>
                    <div class="tab" data-tab="agriculture">üåæ Agricultura</div>
                    <div class="tab" data-tab="map">üó∫Ô∏è Mapa</div>
                    <div class="tab" data-tab="comparison">üìà Comparaci√≥n</div>
                    <div class="tab" data-tab="historical">üìâ Hist√≥rico</div>
                </div>

                <div class="tab-content active" id="charts">
                    <div class="chart-container">
                        <canvas id="predictionChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <canvas id="temperatureTrendChart"></canvas>
                    </div>
                </div>

                <!-- Tab de Recomendaciones -->
                <div class="tab-content" id="recommendations">
                    <div id="healthRecommendations"></div>
                </div>

                <!-- Tab de Agricultura -->
                <div class="tab-content" id="agriculture">
                    <div id="agricultureRecommendations"></div>
                </div>

                <div class="tab-content" id="map">
                    <div id="mapContainer"></div>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="avgTemp">--¬∞C</div>
                            <div class="stat-label">Temperatura Promedio</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="maxTemp">--¬∞C</div>
                            <div class="stat-label">Temperatura M√°xima</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="minTemp">--¬∞C</div>
                            <div class="stat-label">Temperatura M√≠nima</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="alertCount">--</div>
                            <div class="stat-label">Ciudades en Alerta</div>
                        </div>
                    </div>
                </div>

                <div class="tab-content" id="comparison">
                    <div class="chart-container">
                        <canvas id="comparisonChart"></canvas>
                    </div>
                    <div class="comparison-section">
                        <h4>üìã An√°lisis Comparativo</h4>
                        <div id="comparisonAnalysis"></div>
                        <div class="region-comparison" id="regionComparison"></div>
                    </div>
                </div>

                <div class="tab-content" id="historical">
                    <div class="chart-container">
                        <canvas id="historicalChart"></canvas>
                    </div>
                    <div style="background: rgba(255, 255, 255, 0.05); border-radius: 15px; padding: 25px; margin-top: 20px;">
                        <h4>üìà Tendencias Hist√≥ricas</h4>
                        <div id="historicalAnalysis"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Secci√≥n de Eventos Extremos -->
        <div class="full-width-section extreme-events-section" style="margin-top: 40px;">
            <h2>‚ö†Ô∏è Eventos Clim√°ticos Extremos</h2>
            <div class="events-controls">
                <button class="btn-secondary" onclick="loadExtremeEvents()">
                    üîç Analizar Riesgos
                </button>
            </div>
            <div id="extremeEventsContainer" style="margin-top: 25px;"></div>
        </div>

        <!-- Secci√≥n de Recursos H√≠dricos -->
        <div class="full-width-section water-section" style="margin-top: 40px;">
            <h2>üíß An√°lisis de Recursos H√≠dricos</h2>
            <div class="water-controls">
                <button class="btn-secondary" onclick="loadWaterAnalysis()">
                    üìä Evaluar Recursos
                </button>
            </div>
            <div id="waterAnalysisContainer" style="margin-top: 25px;"></div>
        </div>

        <!-- Secci√≥n de Impacto Econ√≥mico -->
        <div class="full-width-section economic-section" style="margin-top: 40px;">
            <h2>üí∞ Impacto Econ√≥mico del Cambio Clim√°tico</h2>
            <div class="economic-controls">
                <button class="btn-secondary" onclick="loadEconomicImpact()">
                    üìà Calcular Impacto
                </button>
            </div>
            <div id="economicImpactContainer" style="margin-top: 25px;"></div>
        </div>

        <!-- Secci√≥n de Biodiversidad -->
        <div class="full-width-section biodiversity-section" style="margin-top: 40px;">
            <h2>ü¶ú Impacto en Biodiversidad</h2>
            <div class="biodiversity-controls">
                <button class="btn-secondary" onclick="loadBiodiversityImpact()">
                    üåø Analizar Biodiversidad
                </button>
            </div>
            <div id="biodiversityContainer" style="margin-top: 25px;"></div>
        </div>

        <div class="full-width-section">
            <h2>üî¨ Informaci√≥n T√©cnica del Sistema</h2>
            <div class="info-grid">
                <div class="info-card">
                    <h3>Arquitectura del Sistema</h3>
                    <p>Backend: Python Flask + scikit-learn</p>
                    <p>Frontend: HTML5 + JavaScript + Chart.js</p>
                    <p>Datos: CSV hist√≥ricos (1990-2023)</p>
                    <p>API: RESTful con endpoints avanzados</p>
                </div>
                <div class="info-card">
                    <h3>Modelos de ML</h3>
                    <p>‚Ä¢ Random Forest & Gradient Boosting</p>
                    <p>‚Ä¢ Regresi√≥n con regularizaci√≥n</p>
                    <p>‚Ä¢ Validaci√≥n cruzada k-fold</p>
                    <p>‚Ä¢ M√©tricas: R¬≤, MAE, RMSE</p>
                </div>
                <div class="info-card">
                    <h3>Caracter√≠sticas del Dataset</h3>
                    <p>‚Ä¢ 14 variables clim√°ticas</p>
                    <p>‚Ä¢ Clasificaci√≥n por regiones</p>
                    <p>‚Ä¢ √çndices de El Ni√±o</p>
                    <p>‚Ä¢ Ciclos solares y tendencias</p>
                </div>
                <div class="info-card">
                    <h3>Nuevas Funcionalidades</h3>
                    <p>‚Ä¢ Recomendaciones de salud</p>
                    <p>‚Ä¢ Calendario agr√≠cola inteligente</p>
                    <p>‚Ä¢ Calidad del aire estimada</p>
                    <p>‚Ä¢ Alertas tempranas avanzadas</p>
                </div>
            </div>
        </div>
    </div>

    <div id="notification" class="notification"></div>
    <script src="{{ url_for('static', filename='climate-dashboard.js') }}"onerror="alert('Error cargando JavaScript. Recarga la p√°gina.')"></script>
</html>